#!/usr/bin/env bash

readonly EXIT_SUCCESS=0
readonly EXIT_FAILURE=1

print_help() {
  local sname=$(echo "$0" | sed 's/.*\///')

cat <<EOF
By: uriid1
  Run an local HTTP server.

Usage:
  $sname [OPTIONS]

Options:
  --path <directory>  Set the path for serving files (default: \$HOME)
  --port <port>       Set the port (default: 8000)

Example:
  $sname --path \$HOME/public
EOF
}

case "$1" in
  --help | -h)
    print_help
    exit $EXIT_SUCCESS
  ;;
esac

log() {
  echo -e "\033[1;32m-->\033[0m $1"
}

warn() {
  echo -e "\033[1;33m[!]\033[0m $1"
}

path="$HOME"
ip=$(ip -j a | jq -r 'first(.[] | select(.ifname | startswith("en")) | .addr_info[0].local)')
port=8000

while [[ $# -gt 0 ]]; do
  case "$1" in
    --path)
      if [ -n "$2" ]; then
        path="$2"
        shift 2
      else
        warn "Argument missing for option $1"
        exit $EXIT_FAILURE
      fi
    ;;

    --port)
      if [ -n "$2" ]; then
        port="$2"
        shift 2
      else
        warn "Argument missing for option $1"
        exit $EXIT_FAILURE
      fi
    ;;

    *)
      warn "Unknown option $1"
      exit $EXIT_FAILURE
    ;;
  esac
done

log "HTTP Server started: $ip:$port"
python -m http.server --directory "$path" $port
